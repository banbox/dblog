# 用户实体
type User @entity {
  id: ID!                          # 钱包地址
  nickname: String                 # 昵称
  avatar: String                   # 头像 URL/IPFS/Arweave ID
  bio: String                      # 个人简介
  articles: [Article!]! @derivedFrom(field: "author")
  comments: [Comment!]! @derivedFrom(field: "user")
  followers: [Follow!]! @derivedFrom(field: "following")
  following: [Follow!]! @derivedFrom(field: "follower")
  totalArticles: Int!
  totalFollowers: Int!
  totalFollowing: Int!
  createdAt: DateTime!
  profileUpdatedAt: DateTime       # 资料最后更新时间
  sessionKey: String               # 当前 Session Key 地址
}

# 文章实体
type Article @entity {
  id: ID!                          # arweaveId (Irys 可变文件夹的 manifest ID，作为主键)
  articleId: BigInt!               # 链上 articleId（用于合约交互）
  author: User!                    # 作者（真实作者，版税/NFT/编辑权限归属）
  originalAuthor: String           # 原始作者名称（字符串，用于转载场景）
  title: String!                   # 文章标题
  summary: String                  # 文章摘要
  categoryId: BigInt!
  royaltyBps: Int!                 # 版税 (需额外查询或默认)
  
  # New Fields
  collectPrice: BigInt!            # 收藏价格
  maxCollectSupply: BigInt!        # 最大收藏数量
  collectCount: BigInt!            # 当前收藏数量
  originality: Int!                # 0:Original, 1:SemiOriginal, 2:Reprint
  
  totalTips: BigInt!               # 累计打赏金额
  likeAmount: BigInt!
  dislikeAmount: BigInt!
  
  comments: [Comment!]! @derivedFrom(field: "article")
  evaluations: [Evaluation!]! @derivedFrom(field: "article")
  collections: [Collection!]! @derivedFrom(field: "article")
  
  createdAt: DateTime!
  editedAt: DateTime               # 文章最后编辑时间
  blockNumber: Int!
  txHash: String!
}

# 评价实体（点赞/踩/打赏）
type Evaluation @entity {
  id: ID!                          # txHash-logIndex
  article: Article!
  user: User!
  score: Int!                      # 0=中立, 1=喜欢, 2=不喜欢
  amount: BigInt!                  # 打赏金额
  comment: String                  # 评论内容
  referrer: String                 # 推荐人地址
  createdAt: DateTime!
  txHash: String!
}

# 评论实体
type Comment @entity {
  id: ID!                          # articleId-commentId
  commentId: BigInt!
  article: Article!
  user: User!
  content: String!
  parentCommentId: BigInt          # 父评论ID（回复时）
  likes: Int!
  createdAt: DateTime!
  txHash: String!
}

# 关注关系
type Follow @entity {
  id: ID!                          # follower-following
  follower: User!
  following: User!
  isActive: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# NFT 收藏记录
type Collection @entity {
  id: ID!                          # articleId-tokenId-collector (Unique per collect event really, or just txHash-logIndex)
  user: User!
  article: Article!
  tokenId: BigInt!
  amount: BigInt!
  createdAt: DateTime!
  txHash: String!
}

# Session Key 交易记录
type Transaction @entity {
  id: ID!                          # txHash-logIndex
  user: User!                      # 主账户（所有者）
  sessionKey: String!              # Session Key 地址
  target: String!                  # 目标合约地址
  selector: String!                # 函数选择器
  value: BigInt!                   # 交易金额
  gasUsed: BigInt                  # 使用的 Gas（可选）
  gasPrice: BigInt                 # Gas 价格（可选）
  blockNumber: Int!                # 区块号
  createdAt: DateTime!             # 交易时间
  txHash: String!                  # 交易哈希
}
